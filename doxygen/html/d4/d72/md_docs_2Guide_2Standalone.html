<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ezp: Standalone Solver</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ezp
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d4/d72/md_docs_2Guide_2Standalone.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Standalone Solver</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> MPI provides a mechanism to dynamically spawn worker processes via <code>MPI_Comm_spawn</code>. By utilising this feature, it is possible to separate the main application from the solver. The architecture can be illustrated as follows.</p>
<p><img src="../../communication.svg" alt="architecture design" style="pointer-events: none;" class="inline"/></p>
<p>The <code>esp</code> solvers are also available as standalone executables that follow the above design. Such a form is particularly beneficial if the following holds.</p>
<ol type="1">
<li>The main application is not suitable for distributed-memory model due to, for example, latency constraints.</li>
<li>The main application adopts a different parallelism pattern.</li>
<li>Sometimes, one may want to have a clear boundary between the main application and the solver(s).</li>
</ol>
<p>However, such a clear boundary may be a shortcoming as well. For example, the root process needs to store the whole matrices in memory, which is subject to physical limitations. However, if the matrices need to be read from IO in a distributed manner, one may also need a refined control of how the data is prepared, by probably directly using <code>BLACS</code>/<code>ScaLAPACK</code>/<code>MPI</code> functions.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Backbone</h1>
<p>Here, we use the <code>pgesv</code> solver as the example to illustrate some critical steps used in implementing the above architecture.</p>
<p>We are not using the raw <code>MPI</code> functions, instead, the <code>mpl</code> library is used. It is necessary to get the default communicator and the parent inter communicator.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;solver.pgesv.cpp:46:49&quot;</span> hl_lines=<span class="stringliteral">&quot;3 4&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/solver.pgesv.cpp:46:49</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><p>Since <code>mpl</code> handles <code>MPI</code> environment initialisation and finalisation, it is necessary to tell <code>ezp</code> to ignore finalising the <code>MPI</code> environment. The function <code><a class="el" href="../../da/d77/classezp_1_1blacs__env.html#a3c2b81ae3260e1661f1ec8757a63b473" title="Disables the management of MPI (Message Passing Interface) finalization.">ezp::blacs_env::do_not_manage_mpi()</a></code> must be called if <code>MPI</code> is managed by external tools.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;solver.pgesv.cpp:77&quot;</span> hl_lines=<span class="stringliteral">&quot;1&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/solver.pgesv.cpp:77:77</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><p>The parameters of the linear system will be broadcast over by the main application first.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;solver.pgesv.cpp:84:92&quot;</span> hl_lines=<span class="stringliteral">&quot;5&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/solver.pgesv.cpp:84:92</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><p>Knowing the problem sizes <code>N</code> and <code>NRHS</code>, the root process can initialise the containers and receive the contents of two matrices.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;solver.pgesv.cpp:54:64&quot;</span> hl_lines=<span class="stringliteral">&quot;1-3 7 8&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/solver.pgesv.cpp:54:64</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><p>Solving the system follows the conventional approach, that is, create a solver object and call the solve method with data wrapped. The solution is sent back to the caller.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;solver.pgesv.cpp:66:71&quot;</span> hl_lines=<span class="stringliteral">&quot;1 5&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/solver.pgesv.cpp:66:71</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
The Caller</h1>
<p>From the above code snippets, one may observe that the caller needs to</p>
<ol type="1">
<li>broadcast <code>config</code>,</li>
<li>send <code>A</code> and <code>B</code>,</li>
<li>receive the error code and the solution <code>X</code> if no error occured.</li>
</ol>
<p>To this end, one can declare the corresponding containers using <code>std::vector</code>.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;runner.cpp:38:39&quot;</span> hl_lines=<span class="stringliteral">&quot;1 2&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/runner.cpp:38:39</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><p>The following creates a diagonal matrix for illustration.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;runner.cpp:45:50&quot;</span> hl_lines=<span class="stringliteral">&quot;5 6&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/runner.cpp:45:50</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><p>Now since all the data is ready to be communicated, the actual communication is very concise and straightforward.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;runner.cpp:95:110&quot;</span> hl_lines=<span class="stringliteral">&quot;2 5 9 10 15 16&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/runner.cpp:95:110</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Full Reference Implementation</h1>
<p>The following is a full reference implementation of a standalone solver and the corresponding caller logic.</p>
<div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;runner.cpp&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/runner.cpp</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --><div class="fragment"><div class="line"> title=<span class="stringliteral">&quot;solver.pgesv.cpp&quot;</span></div>
<div class="line">--8&lt;--</div>
<div class="line">./standalone/solver.pgesv.cpp</div>
<div class="line">--8&lt;--</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
